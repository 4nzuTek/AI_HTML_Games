# FPS Demo 実装仕様書

**作成日時**: 2025年1月12日 3:26

## 📋 プロジェクト概要

Three.jsベースの3D FPSゲーム  
ブラウザ上で動作するマルチプレイヤー対応のファーストパーソンシューティングゲーム

---

## 🎮 ゲーム機能

### **基本操作**
- **WASD**: 移動
- **Space**: ジャンプ
- **Shift**: ダッシュ
- **マウス**: 視点操作
- **左クリック**: 射撃
- **R**: リロード
- **P**: 一人称/三人称切り替え
- **Escape**: ポーズ/ポーズ解除

### **ステージ切り替え**
- **1キー**: アリーナマップ
- **2キー**: アーバンマップ  
- **3キー**: フォレストマップ

### **デバッグ機能**
- **Tキー**: カメラ角度ログ出力

---

## 🔧 技術仕様

### **フレームワーク・ライブラリ**
- **Three.js**: 3D描画エンジン
- **PeerJS**: P2Pマルチプレイヤー通信

### **ファイル構成**
```
3D_test/
├── index.html          # メインHTML
├── main.js            # ゲームロジック
├── style.css          # スタイルシート
├── docs/              # ドキュメント
│   ├── README.md
│   └── development-notes/
└── assets/            # ゲームアセット
    ├── skybox/
    ├── textures/
    ├── models/
    └── sounds/
```

---

## 🎯 プレイヤーシステム

### **移動システム**
- **重力**: 9.8m/s²
- **ジャンプ力**: 5.0
- **移動速度**: 5.0 (通常) / 8.0 (ダッシュ)
- **視点高**: 1.6m
- **コリジョン**: AABBボックス (0.8×1.8×0.8)

### **カメラ制御**
- **マウス感度**: 0.002
- **ピッチ制限**: ±89度
- **視点切り替え**: 一人称⇔三人称
- **視点飛び対策**: 多層入力フィルタリング

### **プレイヤーモデル**
- **頭部**: 球体 (半径0.15, 黄色)
- **胴体**: カプセル (高さ0.9, 半径0.15, 青色)

---

## 🔫 射撃システム

### **武器仕様**
- **発射レート**: フルオート
- **マガジン容量**: 30発
- **総弾薬**: 300発
- **リロード時間**: 2秒

### **弾道物理**
- **弾速**: 高速 (5倍速設定)
- **弾丸**: 黄色球体 (半径0.05)
- **コリジョン**: 補間による抜け防止
- **壁貫通**: 無し (壁で停止)

---

## 🌍 ステージシステム

### **アリーナマップ**
- 中央プラットフォーム + 4つの小島
- シリンダー・ボックスの組み合わせ

### **アーバンマップ**  
- ビル群とストリート
- 高低差のある都市構造

### **フォレストマップ**
- 森林環境
- 自然オブジェクトの配置

### **スカイボックス**
- **Cubemap**: 6面画像対応
- **Equirectangular**: 360度パノラマ対応  
- **フォールバック**: グラデーション生成

---

## 🌐 マルチプレイヤー

### **通信方式**
- **PeerJS**: WebRTCベースのP2P通信
- **ルーム検索**: 自動検索 (fps-room-1~20)
- **同期レート**: 20fps

### **同期データ**
- プレイヤー位置・回転
- 射撃イベント
- プレイヤー名
- ネットワーク補間による滑らかな描画

### **ネットワークプレイヤー**
- 緑色カプセルモデル
- 名前タグ表示
- 補間による滑らかな移動

---

## 💾 データ永続化

### **ローカルストレージ**
- **プレイヤー名**: 前回入力値を保存
- **キー**: `fps_player_name`

---

## 🎨 UI/UX

### **HUD要素**
- **スコア表示**: 左上
- **ヘルス**: 緑バー
- **弾薬カウンター**: 右下  
- **クロスヘア**: 中央
- **接続パネル**: ゲーム開始前

### **操作ヘルプ**
- 画面下部に常時表示
- 全操作方法を簡潔に表示

---

## 🔧 技術的特徴

### **パフォーマンス最適化**
- **描画距離**: far = 1000
- **ネットワーク更新**: 20fps制限
- **ポーズ中も弾道・ネットワーク更新継続**

### **安定性対策**
- **視点飛び防止**: 入力フィルタリング
- **ファイル存在確認**: 404エラー防止
- **エラーハンドリング**: PeerJS接続エラー抑制

### **デバッグ機能**
- **コンソールログ**: 詳細なイベント記録
- **角度表示**: Tキーでカメラ状態確認
- **NaN検出**: 異常値の早期発見

---

## 🎯 動作環境

- **ブラウザ**: Chrome, Firefox, Safari (WebRTC対応)
- **プロトコル**: HTTP/HTTPS
- **ローカルサーバー**: 推奨 (Live Server等)

---

*最終更新: 2025年1月12日 3:26*
